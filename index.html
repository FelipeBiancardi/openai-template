<!DOCTYPE html>
<html>

<head>
    <title>VCard Parser</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@zxing/library@0.17.0/umd/index.min.js"></script>
</head>

<body>
    <video id="preview"></video>
    <div id="parsedContent"></div>
    <script>
        const codeReader = new ZXing.BrowserQRCodeReader();

        const videoElement = document.getElementById('preview');
        const parsedContentElement = document.getElementById('parsedContent');

        codeReader
            .listVideoInputDevices()
            .then((videoInputDevices) => {
                if (videoInputDevices.length > 0) {
                    codeReader
                        .decodeFromVideoDevice(videoInputDevices[0].deviceId, videoElement, (result, err) => {
                            if (result) {
                                const parsedContent = parseVCard(result.text);
                                parsedContentElement.innerText = parsedContent;
                            }
                            if (err && !(err instanceof ZXing.NotFoundException)) {
                                console.error(err);
                            }
                        });
                } else {
                    console.error('No video input devices found.');
                }
            })
            .catch((err) => {
                console.error(err);
            });

        function parseVCard(content) {
            const lines = content.split('\n');
            let parsedContent = '';
            let fullName = '';
            let birthday = '';

            for (const line of lines) {
                if (line.startsWith('FN:')) {
                    fullName = line.substring(3);
                } else if (line.startsWith('N:')) {
                    const nameParts = line.substring(2).split(';');
                    fullName = nameParts[1] + ' ' + nameParts[0];
                } else if ((line.startsWith('ANNIVERSARY:') || line.startsWith('BDAY:')) && !birthday) {
                    birthday = 'Aniversário: ' + formatDate(line.substring(line.indexOf(':') + 1)) + '\n';
                } else if (line.startsWith('GENDER:')) {
                    parsedContent += 'Gênero: ' + (line.substring(7) === 'M' ? 'Masculino' : 'Feminino') + '\n';
                } else if (line.startsWith('EMAIL:')) {
                    parsedContent += 'Email: ' + line.substring(6) + '\n';
                } else if (line.startsWith('TEL:')) {
                    parsedContent += 'Telefone: ' + line.substring(4) + '\n';
                }
            }

            parsedContent = 'Nome: ' + fullName + '\n' + birthday + parsedContent;
            return parsedContent;
        }

        function formatDate(dateString) {
            const year = dateString.substr(0, 4);
            const month = dateString.substr(4, 2);
            const day = dateString.substr(6, 2);
            return `${day}/${month}/${year}`;
        }
    </script>
</body>

</html>